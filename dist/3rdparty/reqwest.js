!function(name,context,definition){"undefined"!=typeof module&&module.exports?module.exports=definition():"function"==typeof define&&define.amd?define(definition):context[name]=definition()}("reqwest",this,function(){function handleReadyState(r,success,error){return function(){return r._aborted?error(r.request):void(r.request&&4==r.request[readyState]&&(r.request.onreadystatechange=noop,twoHundo.test(r.request.status)?success(r.request):error(r.request)))}}function setHeaders(http,o){var h,headers=o.headers||{};headers.Accept=headers.Accept||defaultHeaders.accept[o.type]||defaultHeaders.accept["*"];var isAFormData="function"==typeof FormData&&o.data instanceof FormData;o.crossOrigin||headers[requestedWith]||(headers[requestedWith]=defaultHeaders.requestedWith),headers[contentType]||isAFormData||(headers[contentType]=o.contentType||defaultHeaders.contentType);for(h in headers)headers.hasOwnProperty(h)&&"setRequestHeader"in http&&http.setRequestHeader(h,headers[h])}function setCredentials(http,o){"undefined"!=typeof o.withCredentials&&"undefined"!=typeof http.withCredentials&&(http.withCredentials=!!o.withCredentials)}function generalCallback(data){lastValue=data}function urlappend(url,s){return url+(/\?/.test(url)?"&":"?")+s}function handleJsonp(o,fn,err,url){var reqId=uniqid++,cbkey=o.jsonpCallback||"callback",cbval=o.jsonpCallbackName||reqwest.getcallbackPrefix(reqId),cbreg=new RegExp("((^|\\?|&)"+cbkey+")=([^&]+)"),match=url.match(cbreg),script=doc.createElement("script"),loaded=0,isIE10=-1!==navigator.userAgent.indexOf("MSIE 10.0");return match?"?"===match[3]?url=url.replace(cbreg,"$1="+cbval):cbval=match[3]:url=urlappend(url,cbkey+"="+cbval),win[cbval]=generalCallback,script.type="text/javascript",script.src=url,script.async=!0,"undefined"==typeof script.onreadystatechange||isIE10||(script.htmlFor=script.id="_reqwest_"+reqId),script.onload=script.onreadystatechange=function(){return script[readyState]&&"complete"!==script[readyState]&&"loaded"!==script[readyState]||loaded?!1:(script.onload=script.onreadystatechange=null,script.onclick&&script.onclick(),fn(lastValue),lastValue=void 0,head.removeChild(script),void(loaded=1))},head.appendChild(script),{abort:function(){script.onload=script.onreadystatechange=null,err({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(script),loaded=1}}}function getRequest(fn,err){var http,o=this.o,method=(o.method||"GET").toUpperCase(),url="string"==typeof o?o:o.url,data=o.processData!==!1&&o.data&&"string"!=typeof o.data?reqwest.toQueryString(o.data):o.data||null,sendWait=!1;return"jsonp"!=o.type&&"GET"!=method||!data||(url=urlappend(url,data),data=null),"jsonp"==o.type?handleJsonp(o,fn,err,url):(http=o.xhr&&o.xhr(o)||xhr(o),http.open(method,url,o.async===!1?!1:!0),setHeaders(http,o),setCredentials(http,o),win[xDomainRequest]&&http instanceof win[xDomainRequest]?(http.onload=fn,http.onerror=err,http.onprogress=function(){},sendWait=!0):http.onreadystatechange=handleReadyState(this,fn,err),o.before&&o.before(http),sendWait?setTimeout(function(){http.send(data)},200):http.send(data),http)}function Reqwest(o,fn){this.o=o,this.fn=fn,init.apply(this,arguments)}function setType(header){return header.match("json")?"json":header.match("javascript")?"js":header.match("text")?"html":header.match("xml")?"xml":void 0}function init(o,fn){function complete(resp){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(resp)}function success(resp){var type=o.type||setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(resp,msg,t){for(resp=self.request,self._responseArgs.resp=resp,self._responseArgs.msg=msg,self._responseArgs.t=t,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(resp,msg,t);complete(resp)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(o,fn){return new Reqwest(o,fn)}function normalize(s){return s?s.replace(/\r?\n/g,"\r\n"):""}function serial(el,cb){var ch,ra,val,i,n=el.name,t=el.tagName.toLowerCase(),optCb=function(o){o&&!o.disabled&&cb(n,normalize(o.attributes.value&&o.attributes.value.specified?o.value:o.text))};if(!el.disabled&&n)switch(t){case"input":/reset|button|image|file/i.test(el.type)||(ch=/checkbox/i.test(el.type),ra=/radio/i.test(el.type),val=el.value,(!(ch||ra)||el.checked)&&cb(n,normalize(ch&&""===val?"on":val)));break;case"textarea":cb(n,normalize(el.value));break;case"select":if("select-one"===el.type.toLowerCase())optCb(el.selectedIndex>=0?el.options[el.selectedIndex]:null);else for(i=0;el.length&&i<el.length;i++)el.options[i].selected&&optCb(el.options[i])}}function eachFormElement(){var e,i,cb=this,serializeSubtags=function(e,tags){var i,j,fa;for(i=0;i<tags.length;i++)for(fa=e[byTag](tags[i]),j=0;j<fa.length;j++)serial(fa[j],cb)};for(i=0;i<arguments.length;i++)e=arguments[i],/input|select|textarea/i.test(e.tagName)&&serial(e,cb),serializeSubtags(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var hash={};return eachFormElement.apply(function(name,value){name in hash?(hash[name]&&!isArray(hash[name])&&(hash[name]=[hash[name]]),hash[name].push(value)):hash[name]=value},arguments),hash}function buildParams(prefix,obj,traditional,add){var name,i,v,rbracket=/\[\]$/;if(isArray(obj))for(i=0;obj&&i<obj.length;i++)v=obj[i],traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,traditional,add);else if(obj&&"[object Object]"===obj.toString())for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add);else add(prefix,obj)}var win=window,doc=document,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(o){if(o.crossOrigin===!0){var xhr=win[xmlHttpRequest]?new XMLHttpRequest:null;if(xhr&&"withCredentials"in xhr)return xhr;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(data){return data}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(success,fail){return success=success||function(){},fail=fail||function(){},this._fulfilled?this._responseArgs.resp=success(this._responseArgs.resp):this._erred?fail(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(success),this._errorHandlers.push(fail)),this},always:function(fn){return this._fulfilled||this._erred?fn(this._responseArgs.resp):this._completeHandlers.push(fn),this},fail:function(fn){return this._erred?fn(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(fn),this},"catch":function(fn){return this.fail(fn)}},reqwest.serializeArray=function(){var arr=[];return eachFormElement.apply(function(name,value){arr.push({name:name,value:value})},arguments),arr},reqwest.serialize=function(){if(0===arguments.length)return"";var opt,fn,args=Array.prototype.slice.call(arguments,0);return opt=args.pop(),opt&&opt.nodeType&&args.push(opt)&&(opt=null),opt&&(opt=opt.type),fn="map"==opt?serializeHash:"array"==opt?reqwest.serializeArray:serializeQueryString,fn.apply(null,args)},reqwest.toQueryString=function(o,trad){var prefix,i,traditional=trad||!1,s=[],enc=encodeURIComponent,add=function(key,value){value="function"==typeof value?value():null==value?"":value,s[s.length]=enc(key)+"="+enc(value)};if(isArray(o))for(i=0;o&&i<o.length;i++)add(o[i].name,o[i].value);else for(prefix in o)o.hasOwnProperty(prefix)&&buildParams(prefix,o[prefix],traditional,add);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(o,fn){return o&&(o.type&&(o.method=o.type)&&delete o.type,o.dataType&&(o.type=o.dataType),o.jsonpCallback&&(o.jsonpCallbackName=o.jsonpCallback)&&delete o.jsonpCallback,o.jsonp&&(o.jsonpCallback=o.jsonp)),new Reqwest(o,fn)},reqwest.ajaxSetup=function(options){options=options||{};for(var k in options)globalSetupOptions[k]=options[k]},reqwest});